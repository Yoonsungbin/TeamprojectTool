<!DOCTYPE html>
<html lang="en">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0-wip/css/bootstrap.min.css">
      <script src="http://code.jquery.com/jquery-latest.js"></script>
      <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0-wip/js/bootstrap.min.js"></script>
	<script>
  var Project_Name = new Array();
         var count;
         var User_Name;
	 var User_Email;
         var prjId = 0;
         var btnId = 0;
         var Project_Id = [];
         $.getJSON('/projectcreate', function(data) {
            count = data.length;
            User_Name = data.User_Name;
	    User_Email = data.User_Email;
            for (var j = 0; j < count; j++) {
               Project_Name[j] = data.Project_Name[j];
               Project_Id[j] = data.Project_Id[j];
            }
            prepare();
         });

      function prepare() {
            $(document).ready(function() {
               var name = User_Name;
               $('#user').text(name);
               // 데이터베이스에서 참여하고있는 프로젝트 목록을 읽어옵니다.
               var list = [];
               for (var i = 0; i < count; i++) {
                  list.push({
                     'title' : Project_Name[i],
                     img : 'http://placehold.it/150x150'
                  });
               }
               var text = "";
               $.each(list, function(index, item) {
                  text += "<br><a class='prj' id='" + prjId + "'><img src='http://placehold.it/150x150'><br>" + item.title + "<br></a><div class='tt' id='" +btnId+"'><input type ='button' value='나가기'></div>";
                  prjId++;
                  btnId++;
               });
               $('#prj_list').append(text);
               // prj_list에 text를 덧붙입니다.
            });
         }

 $(document).on("click",".tt",function(){
        alert(this.id);
      $.ajax({
         url : '/projectout',
         dataType : 'json',
         type : 'POST',
         data : {
            'Project_Index' : this.id,                  
        },
         success : function(result) {
           window.location.reload();
         }
              });
        });


           $(document).on("click",".prj",function(){
		$.ajax({
        		 url : '/findProjectId',
		         dataType : 'json',
		         type : 'POST',
		         data : {
		            'Project_Index' : this.id,              	
         //프로젝트 내용
			         },
		       	  success : function(result) {
        		    window.location = result.Next;
		       	 	 }
		     	 });
      	 });

      </script>

	<script>
$.getJSON('/getProjectId', function (data) {
      var User_Name = data.User_Name;
      var Project_Id = data.Project_Id;
      var socket = io();
      var room = Project_Id;
      socket.emit('join',{room:room,name:User_Name});
      socket.emit('getgreet', User_Name +'님이 접속하셨습니다.');
 socket.on('connect', function() {
     $('form').submit(function(){
         var message =$('#m').val();
         socket.emit('getmessage', {message: message,
         name:User_Name
        });
         $('#m').val('');
         return false;
      });
//서버로부터받는것
      socket.on('putgreet', function(msg){
         $('#messages').append($('<h4 align:center>').text(msg));
      });
      socket.on('putmessage', function(msg){
         if(msg.name == User_Name){
            $('#messages').append($('<h4 align="right">').text(msg.message));
         }
         else
         {
            $('#messages').append($('<h4 align="left">').text(msg.name));
            $('#messages').append($('<h4 align="left">').text(msg.message));
         }
//scroll 아래로 내리기
         var el = document.getElementById('messages');
         el.scrollIntoView(false);
      });
   });
});
</script>


      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

      <title>select_project</title>
      <meta name="description" content="">
      <meta name="author" content="PC-164">

      <meta name="viewport" content="width=device-width; initial-scale=1.0">

      <!-- Replace favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
      <link rel="shortcut icon" href="/favicon.ico">
      <link rel="apple-touch-icon" href="/apple-touch-icon.png">
      <style type = "text/css">
         body {
            color: #404040;
            font-family: '함초롬돋움';
            font-size: 4em;
            line-height: 1.2em;
            text-align: center;
         }

      </style>
   </head>

   <body>
      <header>
         <h1>프로젝트 선택</h1>
         <ins id="user"></ins>님이 참여중인 프로젝트
      </header>
      <div id="prj_list"></div>

      <div class="add_proj">
         <div id="add">
            <a data-toggle="modal" href="#myModal" data-role="add">프로젝트 추가하기</a>
         </div>
      </div>

      <!--modal-->
      <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
         <div class="modal-dialog">
            <div class="modal-content">
               <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                     &times;
                  </button>
                  <h4 class="modal-title">프로젝트 추가 하기</h4>
               </div>
               <div class="modal-body">
                  <div id="memo_form">
			<form id="formProjectAdd" name="Project_Add" method="post" action="/projectadd">
                    	 프로젝트 이름
                     	<input type="text" name="Project_Name">
                     	<br>
                    	 마감일
                     	<input type="date" name="Project_Dday">
                     	<br>
                    	 설명
                     	<input type="text" name="Project_Memo">
			<input type="submit" value="ss">
                     	<br>
         		</form>
                  </div>
               </div>
               <div>
                  <div class="modal-footer">
                     <button type="button" class="btn btn-default" data-dismiss="modal">
                        닫기
                     </button>
                     <button type="button" id="save_btn" class="btn btn-primary" data-dismiss="modal">
                        저장
                     </button>
                  </div>               
		</div>
            </div><!--/.modal-content-->
         </div><!--/.modal-dialog-->
      </div><!--/.modal-->
   </body>
</html>
